# 袋子详情页编辑按钮和编辑功能实现

## 用户需求
用户要求在袋子详情页面添加编辑袋子的按钮，并完成编辑袋子的相关操作，包括：
1. 在袋子详情页面的快速操作区域添加编辑按钮
2. 实现编辑袋子功能，支持修改袋子名称和颜色
3. 集成后台编辑袋子接口 `v2/bag/edit` 和获取袋子信息接口 `v2/bag/get`
4. 确保编辑模式下页面标题和按钮文本正确显示
5. 编辑完成后返回袋子详情页面时自动刷新数据

## 实现内容

### 1. 袋子详情页面UI修改
**文件：** `packageStorage/pages/bag-detail/bag-detail.wxml`
- 在快速操作区域添加编辑袋子按钮
- 使用 `cuIcon-edit` 图标和蓝色背景
- 按钮文本为"编辑袋子"

### 2. 袋子详情页面逻辑修改
**文件：** `packageStorage/pages/bag-detail/bag-detail.js`
- 实现 `onEditBag` 方法，构建编辑页面参数并跳转到 `add-bag` 页面
- 传递袋子ID、箱子ID、箱子名称、位置和颜色等参数
- 修改 `onShow` 方法，确保从编辑页面返回时刷新数据

### 3. 添加袋子页面编辑模式支持
**文件：** `packageStorage/pages/add-bag/add-bag.js`

#### 数据结构修改
- 在 `data` 中添加 `isEdit` 和 `bagId` 字段用于标识编辑模式

#### 页面加载逻辑
- 修改 `onLoad` 方法，在编辑模式下设置 `isEdit` 和 `bagId` 字段
- 调用 `loadBagData` 方法加载现有袋子数据

#### 数据加载功能
- 重构 `loadBagData` 方法，使用真实API获取袋子详情
- 添加 `requestBagDetail` 方法，调用 `v2/bag/get` 接口获取袋子信息
- 从袋子列表中找到对应的袋子并返回名称和颜色

#### 数据提交功能
- 修改 `onSubmit` 方法，根据 `isEdit` 标识调用不同的API
- 编辑模式调用 `editBagToServer` 方法
- 新增模式调用 `addBagToServer` 方法
- 添加 `editBagToServer` 方法，调用 `v2/bag/edit` 接口编辑袋子

### 4. 添加袋子页面UI修改
**文件：** `packageStorage/pages/add-bag/add-bag.wxml`
- 修改导航栏标题判断逻辑，从 `bagId` 改为 `isEdit`
- 修改提交按钮文本判断逻辑，从 `bagId` 改为 `isEdit`
- 编辑模式显示"编辑收纳袋"和"保存"，新增模式显示"添加收纳袋"和"创建"

## 后台接口集成

### 获取袋子信息接口
- **接口：** `GET /v2/bag/get`
- **参数：** `openid`（用户ID）、`box_id`（箱子ID）
- **返回：** 袋子列表，包含 `bag_id`、`name`、`color` 等信息

### 编辑袋子接口
- **接口：** `POST /v2/bag/edit`
- **参数：** `openid`（用户ID）、`bag_id`（袋子ID）、`name`（袋子名称）、`color`（袋子颜色）
- **功能：** 更新指定袋子的名称和颜色

## 用户体验优化

### 页面标题和按钮文本
- 编辑模式：页面标题"编辑收纳袋"，按钮文本"保存"
- 新增模式：页面标题"添加收纳袋"，按钮文本"创建"

### 数据刷新机制
- 编辑完成后自动返回袋子详情页面
- 袋子详情页面的 `onShow` 方法确保数据及时刷新
- 显示相应的成功提示信息

### 错误处理
- 网络请求失败时显示错误提示
- 袋子不存在时显示相应错误信息
- 加载过程中显示加载提示

## 技术要点

1. **参数传递：** 通过URL参数在页面间传递袋子和箱子信息
2. **模式判断：** 使用 `isEdit` 字段统一判断编辑模式
3. **API调用：** 根据编辑模式调用不同的后台接口
4. **数据刷新：** 利用页面生命周期方法实现数据自动刷新
5. **用户体验：** 提供清晰的视觉反馈和操作提示

通过以上实现，用户可以在袋子详情页面方便地编辑袋子信息，包括修改名称和颜色，编辑完成后能够看到最新的袋子信息。