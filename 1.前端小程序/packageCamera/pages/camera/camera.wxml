<!--packageCamera/pages/camera/camera.wxml-->

<view class="camera-container">
  <!-- 相机组件 -->
  <camera 
    class="camera-view"
    device-position="{{devicePosition}}"
    flash="{{flashEnabled ? 'on' : 'off'}}"
    bindinitdone="onCameraReady"
    binderror="onCameraError"
    bindscancode="onScanCode"
    scan-area="{{showScanFrame}}"
  >
    <!-- 扫描框 -->
    <view class="scan-frame" wx:if="{{mode === 'scan' && showScanFrame}}">
      <view class="scan-corner scan-corner-tl"></view>
      <view class="scan-corner scan-corner-tr"></view>
      <view class="scan-corner scan-corner-bl"></view>
      <view class="scan-corner scan-corner-br"></view>
      <view class="scan-line"></view>
    </view>
    
    <!-- 拍照预览 -->
    <view class="photo-preview" wx:if="{{photoResult}}">
      <image src="{{photoResult}}" mode="aspectFit"></image>
    </view>
  </camera>
  
  <!-- 顶部工具栏 -->
  <view class="top-toolbar">
    <view class="toolbar-left">
      <view class="tool-btn" bindtap="goBack">
        <text class="cuIcon-back text-white"></text>
      </view>
    </view>
    
    <view class="toolbar-center">
      <view class="mode-switch">
        <view 
          class="mode-item {{mode === 'scan' ? 'active' : ''}}"
          data-mode="scan"
          bindtap="switchMode"
        >
          <text class="cuIcon-scan"></text>
          <text>扫码</text>
        </view>
        <view 
          class="mode-item {{mode === 'photo' ? 'active' : ''}}"
          data-mode="photo"
          bindtap="switchMode"
        >
          <text class="cuIcon-camerafill"></text>
          <text>拍照</text>
        </view>
      </view>
    </view>
    
    <view class="toolbar-right">
      <view class="tool-btn" bindtap="toggleFlash">
        <text class="cuIcon-{{flashEnabled ? 'lightfill' : 'light'}} text-white"></text>
      </view>
    </view>
  </view>
  
  <!-- 操作提示 -->
  <view class="tips-container">
    <view class="tips-text">{{tips[mode]}}</view>
  </view>
  
  <!-- 底部操作栏 -->
  <view class="bottom-toolbar">
    <view class="toolbar-left">
      <view class="tool-btn" bindtap="chooseFromAlbum" wx:if="{{mode === 'photo'}}">
        <text class="cuIcon-pic text-white"></text>
        <text class="tool-text">相册</text>
      </view>
    </view>
    
    <view class="toolbar-center">
      <!-- 扫码模式 -->
      <view class="scan-status" wx:if="{{mode === 'scan'}}">
        <view class="scan-indicator {{processing ? 'processing' : ''}}">
          <text class="cuIcon-scan text-white"></text>
        </view>
        <view class="scan-text" wx:if="{{processing}}">处理中...</view>
      </view>
      
      <!-- 拍照模式 -->
      <view class="photo-controls" wx:if="{{mode === 'photo'}}">
        <view class="photo-btn" bindtap="takePhoto" wx:if="{{!photoResult && !processing}}">
          <view class="photo-btn-inner"></view>
        </view>
        
        <view class="photo-actions" wx:if="{{photoResult}}">
          <button class="cu-btn bg-grey sm" bindtap="retakePhoto">重拍</button>
          <button class="cu-btn bg-blue sm" disabled="{{processing}}" loading="{{processing}}">
            {{processing ? '识别中...' : '确认'}}
          </button>
        </view>
      </view>
    </view>
    
    <view class="toolbar-right">
      <view class="tool-btn" bindtap="switchCamera">
        <text class="cuIcon-refresh text-white"></text>
        <text class="tool-text">翻转</text>
      </view>
    </view>
  </view>
  
  <!-- 处理状态遮罩 -->
  <view class="processing-mask" wx:if="{{processing}}">
    <view class="processing-content">
      <view class="cu-load loading"></view>
      <view class="processing-text">
        {{mode === 'scan' ? '处理扫码结果...' : '识别物品中...'}}
      </view>
    </view>
  </view>
</view>